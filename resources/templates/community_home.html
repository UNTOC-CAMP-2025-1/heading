<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë°±ì¤€ì§€ì§€</title>
    <link rel="stylesheet" th:href="@{/css/community.css}">
    <link rel="stylesheet" th:href="@{/css/nav.css}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100..900&display=swap">
</head>

<body>
<nav class="nav-main">
    <div onclick="location.href = '/main'" style="cursor:pointer;" class="nav-left">
        <img th:src="@{/img/ì„ì‹œë¡œê³ .png}" alt="Baekjoon GG Logo" class="site-logo" />
        <p style="float: right;">BAEKJOON.GG</p>
    </div>

    <div class="nav-mid">
        <a style="margin-left: 10%;" th:href="@{/ranking/home}" class="nav-link">ë­í‚¹</a>
        <a th:href="@{/problem}" class="nav-link">ë¬¸ì œ</a>
        <a th:href="@{/community/home}" class="nav-link">ì»¤ë®¤ë‹ˆí‹°</a>
        <a th:href="@{/search/home}" class="nav-link">í”„ë¡œí•„</a>
    </div>
    <div class="nav-right">
        <a th:href="@{/signup/home}" class="auth-link">ì‚¬ìš©ìë“±ë¡</a>
    </div>
</nav>

<main>
    <div class="main-left">
        <div class="main-title">
            <span style="color: #350FC0;">ììœ ê²Œì‹œíŒ</span>
        </div>

        <div class="wrap-articles" id="post-body">
            <div class="main-write" id="writeBtn">
                <span>ìƒˆ ê¸€ì„ ì‘ì„±í•´ì£¼ì„¸ìš”!</span>
            </div>
            <form class="write" id="post-form" style="display: none;">
                <div class="nickname">
                    <input type="text" id="author" name="author" placeholder="ë‹‰ë„¤ì„" required>
                </div>
                <div class="title">
                    <input type="text" id="title" name="title" placeholder="ê¸€ ì œëª©" required>
                </div>
                <div class="content">
          <textarea id="content" name="content" placeholder="ë°±ì¤€ì§€ì§€ëŠ” ëˆ„êµ¬ë‚˜ ê¸°ë¶„ ì¢‹ê²Œ ì°¸ì—¬í•  ìˆ˜ ìˆëŠ” ì»¤ë®¤ë‹ˆí‹°ë¥¼ ë§Œë“¤ê¸° ìœ„í•´ ì»¤ë®¤ë‹ˆí‹° ì´ìš©ê·œì¹™ì„ ì œì •í•˜ì—¬ ìš´ì˜í•˜ê³  ìˆìŠµë‹ˆë‹¤.

ìœ„ë°˜ ì‹œ ê²Œì‹œë¬¼ì´ ì‚­ì œë˜ê³  ì„œë¹„ìŠ¤ ì´ìš©ì´ ì¼ì • ê¸°ê°„ ì œí•œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì•„ë˜ëŠ” ì´ ê²Œì‹œíŒì— í•´ë‹¹í•˜ëŠ” í•µì‹¬ ë‚´ìš©ì— ëŒ€í•œ ìš”ì•½ ì‚¬í•­ì´ë©°, ê²Œì‹œë¬¼ ì‘ì„± ì „ ì»¤ë®¤ë‹ˆí‹° ì´ìš©ê·œì¹™ ì „ë¬¸ì„ ë°˜ë“œì‹œ í™•ì¸í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.

â€» ê·œì¹™ ìœ„ë°˜
- íƒ€ì¸ì˜ ê¶Œë¦¬ë¥¼ ì¹¨í•´í•˜ê±°ë‚˜ ë¶ˆì¾Œê°ì„ ì£¼ëŠ” í–‰ìœ„
- ë²”ì£„, ë¶ˆë²• í–‰ìœ„ ë“± ë²•ë ¹ì„ ìœ„ë°˜í•˜ëŠ” í–‰ìœ„
- ìš•ì„¤, ë¹„í•˜, ì°¨ë³„, í˜ì˜¤, ìì‚´, í­ë ¥ ê´€ë ¨ ë‚´ìš©
- ìŒë€ë¬¼, ì„±ì  ìˆ˜ì¹˜ì‹¬ ìœ ë°œ
- ìŠ¤í¬ì¼ëŸ¬, ê³µí¬, ë†€ëŒ ë“±" required></textarea>
                </div>
                <div class="write-password">
                    <input type="password" id="password" name="password" placeholder="ë¹„ë°€ë²ˆí˜¸ (ìˆ˜ì •/ì‚­ì œìš©)" required>
                </div>
                <div class="write-footer">
                    <button type="submit">ê¸€ì“°ê¸°</button>
                </div>
            </form>

            <div id="pagination" style="margin-top: 15px;"></div>
        </div>
    </div>

    <div class="main-right">
        <div style="display: none;" class="main-right-1">
            <div class="main-right-title">
                <span>ì‹¤ì‹œê°„ ì¸ê¸°ê¸€</span>
            </div>
            <div class="main-right-1-contents"></div>
        </div>
        <div class="main-right-2">
            <div class="main-right-title">
                <span>ì¶”ì²œê²Œì‹œë¬¼</span>
            </div>
            <div class="main-right-2-contents"><span>ë°±ì¤€ ê³µë¶€ë²•</span></div>
            <div class="main-right-2-contents"><span>ì½”ë“œ ì˜¤ë¥˜ ì°¾ê¸°</span></div>
            <div class="main-right-2-contents"><span>ë¨¸ì‹œê¸° ì•”íŠ¼ í•„ìš”í•œ ê±°</span></div>
            <div class="main-right-2-contents"><span>ì´ê±´ ì½ì–´ì•¼ì§€</span></div>
        </div>
    </div>
</main>

<footer>
    <div class="update">
        <p>ì—…ë°ì´íŠ¸</p>
    </div>
    <div class="footer-info">
        <div style="margin-left: 15%;">
            <p style="color: #ABABAB;">ë¶€ì‚°ê´‘ì—­ì‹œ ê¸ˆì •êµ¬ ë¶€ì‚°ëŒ€í•™ë¡œ63ë²ˆê¸¸ 2 (ì¥ì „ë™) ë¶€ì‚°ëŒ€í•™êµ ì†Œí”„íŠ¸ì›¨ì–´ìœµí•©êµìœ¡ì›</p>
            <p style="color: #ABABAB;">TEL : 051-123-4567, 321, 1026</p>
            <p style="color: #D9D9D9">CopyrightÂ© Pusan National Univ. All Right Reserved.</p>
            <p style="color: #ABABAB;">Powered by <span style="color: #350FC0;">OnlineJudge</span></p>
        </div>
    </div>
</footer>

<script>
    document.getElementById("writeBtn").addEventListener("click", () => {
        document.getElementById("writeBtn").style.display = "none";
        document.getElementById("post-form").style.display = "inline-block";
    });

    document.getElementById("post-form").addEventListener("submit", function (e) {
        e.preventDefault();

        const author = document.getElementById("author").value.trim();
        const title = document.getElementById("title").value.trim();
        const content = document.getElementById("content").value.trim();
        const password = document.getElementById("password").value;

        if (!author || !title || !content || !password) {
            alert("ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            return;
        }

        fetch("/community/post", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ author, title, content, password })
        })
            .then(response => {
                if (!response.ok) {
                    return response.text().then(text => { throw new Error(text); });
                }
                alert("ì‘ì„± ì™„ë£Œ!");
                document.getElementById("post-form").reset();
                document.getElementById("post-form").style.display = "none";
                document.getElementById("writeBtn").style.display = "block";
                loadPosts(0); // ì²« í˜ì´ì§€ ë‹¤ì‹œ ë¡œë”©
            })
            .catch(error => {
                alert("ì‘ì„± ì‹¤íŒ¨: " + error.message);
            });
    });

    let currentPage = 0;

    function loadPosts(page) {
        fetch(`/community/read/pages?page=${page}&size=10`)
            .then(response => response.json())
            .then(data => {
                const tbody = document.getElementById("post-body");

                // ê¸°ì¡´ ê¸€ ì œê±°
                const existingArticles = tbody.querySelectorAll('.main-article');
                existingArticles.forEach(el => el.remove());

                data.content.forEach(post => {
                    const row = document.createElement("a");
                    row.className = `main-article`;
                    row.href = `/community/read/home/${post.id}`;
                    row.target = `_blank`;
                    row.innerHTML = `
            <h3>${post.title}</h3>
            <p>
              <span>${post.author}</span> /
              <span>${new Date(post.createdAt).toLocaleString()}</span> /
              <span>ğŸ’¬ ${post.commentCount ?? 0}ê°œ</span>
            </p>
          `;
                    tbody.appendChild(row);
                });

                renderPagination(data);
                currentPage = data.number;
            });
    }

    function renderPagination(data) {
        const pagination = document.getElementById("pagination");
        pagination.innerHTML = "";

        if (data.number > 0) {
            const prev = document.createElement("button");
            prev.textContent = "ì´ì „";
            prev.onclick = () => loadPosts(data.number - 1);
            pagination.appendChild(prev);
        }

        const pageInfo = document.createElement("span");
        pageInfo.textContent = ` í˜ì´ì§€ ${data.number + 1} / ${data.totalPages} `;
        pagination.appendChild(pageInfo);

        if (data.number + 1 < data.totalPages) {
            const next = document.createElement("button");
            next.textContent = "ë‹¤ìŒ";
            next.onclick = () => loadPosts(data.number + 1);
            pagination.appendChild(next);
        }
    }

    window.onload = () => {
        loadPosts(0);
    };
</script>
</body>

</html>
